# Threads Reference

## `(active thread)` -> Thread
Returns the currently active thread.

This is always the thread that contains the block, because it is impossible to run this block without it being in the active thread.

<details>
  <summary>Internal behavior</summary>
  
  Wraps `vm.runtime.sequencer.activeThread`.
</details>

## `(null thread)` -> Thread
Returns the null thread.

This represents a thread that failed to load or doesn't exist. It has an ID of `undefined`. This thread is also used when the wrong type is inserted into a thread input.

## `(thread at (INDEX v))` -> Thread
Returns the thread that is at `INDEX` in the running threads list. If `INDEX` is 0, returns the last thread.

<details>
  <summary>Internal behavior</summary>
  
  Pulls from the `vm.runtime.threads` array.
</details>

---

## `(target of [THREAD])` -> Target
Returns the target that is running / ran `THREAD`.

<details>
  <summary>Internal behavior</summary>
  
  Wraps the `target` key from the raw thread object.
</details>

## `(id of [THREAD])` -> String
Returns a unique identifier for `THREAD`. This ID is generated by the extension and is not used in the PenguinMod engine.

<details>
  <summary>Internal behavior</summary>
  
  Returns the custom `soupThreadId` key from the raw thread object.
</details>

## `(status of [THREAD])` -> Number
Returns the current status code of `THREAD`. These are the possible values:

| Status | Display name         | Description                                                  |
|--------|----------------------|--------------------------------------------------------------|
| 0      | Running              | The thread is not finished.[^1]                              |
| 1      | Waiting for promise  | Behavior unknown                                             |
| 2      | Yielded              | Behavior unknown                                             |
| 3      | Yielded for one tick | Behavior unknown                                             |
| 4      | Completed            | The thread is "dead", i.e. it will never run code again.[^1] |
| 5      | Paused               | Behavior unknown                                             |

<details>
  <summary>Internal behavior</summary>
  
  Returns the `status` key from the raw thread object.
</details>

---

## `<[THREADONE] is [THREADTWO]>` -> Boolean
Returns `true` if the IDs of the threads match, otherwise returns `false`.

Note that the `<[] = []>` block in Operators will not work for this, as that block compares the stringified value.

<details>
  <summary>Internal behavior</summary>
  
  Uses `soupThreadId` to compare the threads.
</details>

## `<[VALUE] is a thread?>` -> Boolean
Returns `true` if `VALUE` is a thread, otherwise returns `false`.

## `<[THREAD] is null?>` -> Boolean
Returns `true` if `THREAD` is the null thread.

## `<[THREAD] is alive?>` -> Boolean
Returns `true` if `THREAD` is alive, i.e. it is not finished.

<details>
  <summary>Internal behavior</summary>
  
  Returns `true` if the raw thread is in the `vm.runtime.threads` array.
</details>

## `<[THREAD] exited naturally?>` -> Boolean
Returns `true` if `THREAD` is dead, but was not killed, i.e. it exited of its own accord.[^2]

<details>
  <summary>Internal behavior</summary>
  
  Returns `true` if:
  - The raw thread is not in the `vm.runtime.threads` array (therefore it is dead).
  - The raw thread's `isKilled` key is `false`.
  - The raw thead's `status` key is 4 (completed). This catches the `stop [all v]` case in which killed threads have `isKilled` set to `false` and `status` unchanged.
</details>

## `<[THREAD] was killed?>` -> Boolean
Returns `true` if `THREAD` exited due to an external cause.[^2]

<details>
  <summary>Internal behavior</summary>
  
  Returns `true` if:
  - The raw thread is not in the `vm.runtime.threads` array (therefore it is dead).
  - Either:
    - The raw thread's `isKilled` key is `true`.
    - The raw thead's `status` key is not 4 (completed). This catches the `stop [all v]` case in which killed threads have `isKilled` set to `false` and `status` unchanged.
</details>

## `<[THREAD] was started by clicking in the editor?>` -> Boolean
Returns `true` if `THREAD` was started by manually clicking a stack in the code editor.

<details>
  <summary>Internal behavior</summary>
  
  Returns the `stackClick` key from the raw thread object.
</details>

---

## `(running threads)` -> Array\[Thread\]
Returns all threads that are currently alive in their execution order.

<details>
  <summary>Internal behavior</summary>
  
  Wraps the `vm.runtime.threads` array.
</details>

## `(position of [THREAD])` -> Number
Returns the index of `THREAD` in the list of alive threads.

<details>
  <summary>Internal behavior</summary>
  
  Uses `soupThreadId` to compare `THREAD` to the threads in the `vm.runtime.threads` array, and returns the index if a match is found.
</details>



[^1]: In the case where `stop [all v]` is used, the status of all threads except the thread that ran the block will stay unchanged, rather than becoming status 4, even though the affected threads are now dead. To reliably check if a thread is alive, use [`<[THREAD] is alive?>`](#thread-is-alive---boolean).

[^2]: The one exception to this is when `stop [all v]` is used, the thread that ran the block will be considered "killed", even though it caused its own termination.
